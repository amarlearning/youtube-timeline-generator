(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(45256)}])},45256:function(e,t,l){"use strict";l.r(t),l.d(t,{__N_SSG:function(){return eq},default:function(){return eV}});var r,a,s=l(85893),n=l(67294),o=l(61162),i=l(9008),d=l.n(i);let c=e=>{let{initialState:t}=e,l=(e,l)=>{if(!l.type)return{...e,[l.field]:l.value};if("reset"===l.type)return t;throw Error()},[r,a]=(0,n.useReducer)(l,t);return(0,n.useMemo)(()=>({state:r,dispatch:a}),[r,a])};var u=l(83454);let m=()=>{let e=async e=>{let t="".concat(e.url,"/v1/models");try{let l=await fetch(t,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.key?e.key:u.env.OPENAI_API_KEY)}}),r=await l.json(),a=r.data;if(a&&a.length>0)return a.map(e=>(-1===e.id.indexOf(":")||e.name||(e.name=e.id.split(":")[1],e.id=e.id.split(":")[0]),e));return[]}catch(e){return{}}};return{getModels:e}};(r=a||(a={})).GPT_3_5="gpt-3.5-turbo",r.LLAMA_2_CHAT="llama-2-chat",r.GPT_3_5_AZ="gpt-35-turbo",r.GPT_4="gpt-4",r.GPT_4_32K="gpt-4-32k",a.LLAMA_2_CHAT;let x={[a.GPT_3_5]:{id:a.GPT_3_5,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[a.LLAMA_2_CHAT]:{id:a.LLAMA_2_CHAT,name:"LLAMA_2_CHAT",maxLength:12e3,tokenLimit:4e3},[a.GPT_3_5_AZ]:{id:a.GPT_3_5_AZ,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[a.GPT_4]:{id:a.GPT_4,name:"GPT-4",maxLength:24e3,tokenLimit:8e3},[a.GPT_4_32K]:{id:a.GPT_4_32K,name:"GPT-4-32K",maxLength:96e3,tokenLimit:32e3}};var p=l(83454);p.env.NEXT_PUBLIC_DEFAULT_SYSTEM_PROMPT,p.env.OPENAI_API_HOST;let h=parseFloat(p.env.NEXT_PUBLIC_DEFAULT_TEMPERATURE||"1");p.env.OPENAI_API_TYPE,p.env.OPENAI_API_VERSION,p.env.OPENAI_ORGANIZATION,p.env.AZURE_DEPLOYMENT_ID;let g=e=>{let t=e;return t.model||(t={...t,model:t.model||x[a.GPT_3_5]}),t.temperature||(t={...t,temperature:t.temperature||h}),t.folderId||(t={...t,folderId:t.folderId||null}),t.messages||(t={...t,messages:t.messages||[]}),t},v=e=>Array.isArray(e)?e.reduce((e,t)=>{try{t.model||(t.model=x[a.GPT_3_5]),t.temperature||(t.temperature=h),t.folderId||(t.folderId=null),t.messages||(t.messages=[]),e.push(t)}catch(e){console.warn("error while cleaning conversations' history. Removing culprit",e)}return e},[]):(console.warn("history is not an array. Returning an empty array."),[]),f=(e,t)=>{let l=t.map(t=>t.id===e.id?e:t);return b(e),w(l),{single:e,all:l}},b=e=>{localStorage.setItem("selectedConversation",JSON.stringify(e))},w=e=>{localStorage.setItem("conversationHistory",JSON.stringify(e))},y=e=>{localStorage.setItem("folders",JSON.stringify(e))},j=e=>{localStorage.setItem("prompts",JSON.stringify(e))},k="settings",N=()=>{let e={theme:"dark",isStream:!0},t=localStorage.getItem(k);if(t)try{let l=JSON.parse(t);e=Object.assign(e,l)}catch(e){console.error(e)}return e},C=e=>{localStorage.setItem(k,JSON.stringify(e))};var S=l(33111),L=l(51668);let I=(0,n.createContext)(void 0);var _=l(30904),E=l(20487),P=l(59348),T=l(23461),A=l(63072);let z=e=>{let{prompts:t,activePromptIndex:l,onSelect:r,onMouseOver:a,promptListRef:n}=e;return(0,s.jsx)("ul",{ref:n,className:"z-10 max-h-52 w-full overflow-scroll rounded border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-neutral-500 dark:bg-[#343541] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)]",children:t.map((e,t)=>(0,s.jsx)("li",{className:"".concat(t===l?"bg-gray-200 dark:bg-[#202123] dark:text-black":""," cursor-pointer px-3 py-2 text-sm text-black dark:text-white"),onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},onMouseEnter:()=>a(t),children:e.name},e.id))})},O=e=>{let{prompt:t,variables:l,onSubmit:r,onClose:a}=e,[o,i]=(0,n.useState)(l.map(e=>({key:e,value:""})).filter((e,t,l)=>l.findIndex(t=>t.key===e.key)===t)),d=(0,n.useRef)(null),c=(0,n.useRef)(null),u=(e,t)=>{i(l=>{let r=[...l];return r[e].value=t,r})},m=()=>{if(o.some(e=>""===e.value)){alert("Please fill out all variables");return}r(o.map(e=>e.value)),a()},x=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&a():(e.preventDefault(),m())};return(0,n.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&a()};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[a]),(0,n.useEffect)(()=>{c.current&&c.current.focus()},[]),(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onKeyDown:x,children:(0,s.jsxs)("div",{ref:d,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,s.jsx)("div",{className:"mb-4 text-xl font-bold text-black dark:text-neutral-200",children:t.name}),(0,s.jsx)("div",{className:"mb-4 text-sm italic text-black dark:text-neutral-200",children:t.description}),o.map((e,t)=>(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("div",{className:"mb-2 text-sm font-bold text-neutral-200",children:e.key}),(0,s.jsx)("textarea",{ref:0===t?c:void 0,className:"mt-1 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:"Enter a value for ".concat(e.key,"..."),value:e.value,onChange:e=>u(t,e.target.value),rows:3})]},t)),(0,s.jsx)("button",{className:"mt-6 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:m,children:"Submit"})]})})},Z=e=>{var t;let{onSend:l,onRegenerate:r,maxImg:a,onScrollDownClick:i,stopConversationRef:d,textareaRef:c,showScrollDownButton:u}=e,{t:m}=(0,o.$G)("chat"),{state:{selectedConversation:x,messageIsStreaming:p,prompts:h},dispatch:g}=(0,n.useContext)(I),[v,f]=(0,n.useState)(),[b,w]=(0,n.useState)(!1),[y,j]=(0,n.useState)(!1),[k,N]=(0,n.useState)(0),[C,S]=(0,n.useState)(""),[L,Z]=(0,n.useState)([]),[D,R]=(0,n.useState)(!1),[K,G]=(0,n.useState)(!1),[M,J]=(0,n.useState)(null),[U,H]=(0,n.useState)(!1),[F,$]=(0,n.useState)(""),B=(0,n.useRef)(null),W=h.filter(e=>e.name.toLowerCase().includes(C.toLowerCase())),Y=e=>{let t=e.target.value,l=null==x?void 0:x.model.maxLength;if(l&&t.length>l){alert(m("Message limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:l,valueLength:t.length}));return}f(t),et(t)},X=()=>{let e=ea;if(U&&(e=ed()),p)return;if(!v){alert(m("Please enter a message"));return}let t=v;e.length>0&&(t=[{type:"text",text:v}],e.forEach(e=>{Array.isArray(t)&&t.push({type:"image_url",image_url:{url:e}})})),l({role:"user",content:t},M),f(""),es([]),J(null),window.innerWidth<640&&c&&c.current&&c.current.blur()},V=()=>{let e=void 0===window.navigator?"":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},q=()=>{let e=W[k];e&&(f(t=>null==t?void 0:t.replace(/\/\w*$/,e.content)),el(e)),j(!1)},Q=e=>{y?"ArrowDown"===e.key?(e.preventDefault(),N(e=>e<h.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),N(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),N(e=>e<h.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),q()):"Escape"===e.key?(e.preventDefault(),j(!1)):N(0):"Enter"!==e.key||b||V()||e.shiftKey?"/"===e.key&&e.metaKey&&(e.preventDefault(),G(!K)):(e.preventDefault(),X())},ee=e=>{let t;let l=/{{(.*?)}}/g,r=[];for(;null!==(t=l.exec(e));)r.push(t[1]);return r},et=(0,n.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(j(!0),S(t[0].slice(1))):(j(!1),S(""))},[]),el=e=>{let t=ee(e.content);Z(t),t.length>0?R(!0):(f(t=>null==t?void 0:t.replace(/\/\w*$/,e.content)),et(e.content))},er=e=>{let t=null==v?void 0:v.replace(/{{(.*?)}}/g,(t,l)=>{let r=L.indexOf(l);return e[r]});f(t),c&&c.current&&c.current.focus()};(0,n.useEffect)(()=>{B.current&&(B.current.scrollTop=30*k)},[k]),(0,n.useEffect)(()=>{if(c&&c.current){var e,t;c.current.style.height="inherit",c.current.style.height="".concat(null===(e=c.current)||void 0===e?void 0:e.scrollHeight,"px"),c.current.style.overflow="".concat((null==c?void 0:null===(t=c.current)||void 0===t?void 0:t.scrollHeight)>400?"auto":"hidden")}},[v]),(0,n.useEffect)(()=>{let e=e=>{B.current&&!B.current.contains(e.target)&&j(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]);let[ea,es]=(0,n.useState)([]),en=e=>{let t=e.target.files;if(t){let e=[],l=[];for(let r=0;r<t.length;r++){let a=t[r],s=new FileReader;l.push(new Promise(t=>{s.onloadend=()=>{e.push(s.result),t()}})),s.readAsDataURL(a)}Promise.all(l).then(()=>{eo(e)})}},eo=e=>{let t;if(ea.length+e.length<=a)t=[...ea,...e];else{let l=[...e,...e];t=l.slice(-a)}return es(t),t},ei=e=>{es(t=>{let l=[...t];return l.splice(e,1),l})},ed=()=>{let e=[];return H(!1),F&&(e=eo([F]),$("")),e};return(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 w-full border-transparent bg-gradient-to-b from-transparent via-white to-white pt-6 dark:border-white/20 dark:via-[#343541] dark:to-[#343541] md:pt-2",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:en,style:{display:"none"},id:"upload-button"}),(0,s.jsx)("div",{className:"lg:mx-auto lg:max-w-3xl mx-2 md:mx-4 mt-4 md:mt-[52px] ",children:(0,s.jsx)("div",{className:"flex justify-start"+(ea.length>0?" mt-4":""),children:(0,s.jsxs)("div",{className:"text-black flex items-center p-2 mx-2 sm:mx-4 w-full rounded-t-md bg-white border-black/10 dark:text-white dark:border-gray-900/50 dark:bg-[#40414f] border-t border-x",children:[(0,s.jsx)("button",{title:"upload image file",disabled:0===a,className:"p-2 mr-2 bg-[#ececec] dark:bg-[#343541] rounded-lg"+(0===a?" cursor-not-allowed":""),onClick:()=>{var e;null===(e=document.getElementById("upload-button"))||void 0===e||e.click()},children:(0,s.jsx)(_.Z,{size:20})}),U?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{onChange:e=>{$(e.target.value)},id:"imgUrlInputBox",autoFocus:!0,style:{height:"2.25rem"},className:"px-2 h-full bg-[#ececec] dark:bg-[#343541] rounded-l-lg"}),(0,s.jsx)("button",{title:"upload",className:"p-2 bg-[#ececec] dark:bg-[#343541] rounded-r-lg",onClick:ed,children:F?"Submit":"Close"})]}):(0,s.jsx)("button",{disabled:0===a,title:"Upload images by entering the url",className:"p-2 bg-[#ececec] dark:bg-[#343541] rounded-lg"+(0===a?" cursor-not-allowed":""),onClick:()=>{H(!0)},children:(0,s.jsx)(E.Z,{size:20})}),(0,s.jsx)("div",{className:"ml-4 "+(0===a?"hidden":"block"),children:"For Llava series models, please submit an image URL or upload an image."})]})})}),(0,s.jsx)("div",{className:"stretch mx-2 flex flex-row gap-3 last:mb-2 md:mx-4 md:last:mb-6 lg:mx-auto lg:max-w-3xl",children:(0,s.jsxs)("div",{className:"relative mx-2 flex w-full flex-grow flex-col rounded-b-md border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-gray-900/50 dark:bg-[#40414F] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] sm:mx-4",children:[(0,s.jsx)("div",{className:"absolute left-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 dark:bg-opacity-50 dark:text-neutral-100",children:(0,s.jsx)(P.Z,{size:20})}),(0,s.jsx)("textarea",{ref:c,className:"m-0 w-full resize-none border-0 bg-transparent p-0 py-2 pr-8 pl-10 text-black dark:bg-transparent dark:text-white md:py-3 md:pl-10",style:{resize:"none",bottom:"".concat(null==c?void 0:null===(t=c.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"400px",overflow:"".concat(c.current&&c.current.scrollHeight>400?"auto":"hidden")},placeholder:m('Type a message or type "/" to select a prompt...')||"",value:v,rows:1,onCompositionStart:()=>w(!0),onCompositionEnd:()=>w(!1),onChange:Y,onKeyDown:Q}),(0,s.jsx)("button",{className:"absolute right-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:X,children:p?(0,s.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-t-2 border-neutral-800 opacity-60 dark:border-neutral-100"}):(0,s.jsx)(T.Z,{size:18})}),u&&(0,s.jsx)("div",{className:"absolute bottom-12 right-0 lg:bottom-0 lg:-right-10",children:(0,s.jsx)("button",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-neutral-300 text-gray-800 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-neutral-200",onClick:i,children:(0,s.jsx)(A.Z,{size:18})})}),y&&W.length>0&&(0,s.jsx)("div",{className:"absolute bottom-12 w-full",children:(0,s.jsx)(z,{activePromptIndex:k,prompts:W,onSelect:q,onMouseOver:N,promptListRef:B})}),D&&(0,s.jsx)(O,{prompt:W[k],variables:L,onSubmit:er,onClose:()=>R(!1)})]})}),(0,s.jsx)("div",{className:"lg:mx-auto lg:max-w-3xl",children:(0,s.jsx)("div",{className:"flex mx-2 sm:mx-4"+(ea.length>0?" mt-4":""),children:ea.map((e,t)=>(0,s.jsx)("div",{style:{position:"relative",display:"inline-block",marginRight:"10px"},children:(0,s.jsxs)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",position:"relative"},children:[(0,s.jsx)("img",{src:e,alt:"Uploaded",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,s.jsx)("div",{style:{position:"absolute",top:"5px",right:"5px",cursor:"pointer"},onClick:()=>ei(t),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-circle",viewBox:"0 0 16 16",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zM7.354 8l-2.88 2.879a.5.5 0 0 1-.708-.708L6.646 8 3.766 5.121a.5.5 0 0 1 .708-.708L8 7.354l2.879-2.88a.5.5 0 0 1 .708.708L8.354 8l2.879 2.879a.5.5 0 0 1-.708.708L8 8.354 5.121 11.233a.5.5 0 0 1-.708-.708L7.354 8z"})})})]})},t))})}),(0,s.jsxs)("div",{className:"px-3 pt-2 pb-3 text-center text-[12px] text-black/50 dark:text-white/50 md:px-4 md:pt-3 md:pb-6",children:[(0,s.jsx)("span",{children:"Based on "}),(0,s.jsx)("a",{href:"https://github.com/second-state/chatbot-ui",target:"_blank",rel:"noreferrer",className:"underline",children:"chatbot-ui"})]})]})};var D=l(90553);let R=()=>(0,s.jsx)("div",{className:"group border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100",style:{overflowWrap:"anywhere"},children:(0,s.jsxs)("div",{className:"m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,s.jsx)("div",{className:"min-w-[40px] items-end",children:(0,s.jsx)(D.Z,{size:30})}),(0,s.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"})]})}),K=e=>{let{size:t="1em",className:l=""}=e;return(0,s.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin ".concat(l),height:t,width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,s.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,s.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,s.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,s.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,s.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,s.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,s.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})};var G=l(58403);let M=e=>{let{error:t}=e;return(0,s.jsxs)("div",{className:"mx-6 flex h-full flex-col items-center justify-center text-red-500",children:[(0,s.jsx)("div",{className:"mb-5",children:(0,s.jsx)(G.Z,{size:36})}),(0,s.jsx)("div",{className:"mb-3 text-2xl font-medium",children:t.title}),t.messageLines.map((e,t)=>(0,s.jsxs)("div",{className:"text-center",children:[" ",e," "]},t)),(0,s.jsx)("div",{className:"mt-4 text-xs opacity-50 dark:text-red-400",children:t.code?(0,s.jsxs)("i",{children:["Code: ",t.code]}):""})]})},J=[{id:"llama-2-chat",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"codellama-instruct",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"vicuna-chat",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"chatml",description:"",content:"Answer as concisely as possible.",controlState:1},{id:"mistral-instruct-v0.1",description:"",content:"",controlState:2},{id:"belle-llama-2-chat",description:"",content:"",controlState:2}],U=()=>{var e;let{t}=(0,o.$G)("chat"),{state:{selectedConversation:l,models:r,defaultModelId:a},handleUpdateConversationAll:i,dispatch:d}=(0,n.useContext)(I);return(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:t("Model")}),(0,s.jsx)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,s.jsx)("div",{className:"w-full p-2",children:(null==l?void 0:null===(e=l.model)||void 0===e?void 0:e.id)||a})})]})},H=e=>{var t;let{conversation:l,prompts:r,onChangePrompt:a}=e,{t:i}=(0,o.$G)("chat"),[d,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(0),[x,p]=(0,n.useState)(!1),[h,g]=(0,n.useState)(""),[v,f]=(0,n.useState)([]),[b,w]=(0,n.useState)(!1),y=(0,n.useRef)(null),j=(0,n.useRef)(null),k=r.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())),N=e=>{let t=e.target.value,r=l.model.maxLength;if(t.length>r){alert(i("Prompt limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:r,valueLength:t.length}));return}c(t),L(t),a(t)},C=()=>{let e=k[u];c(t=>{let l=null==t?void 0:t.replace(/\/\w*$/,e.content);return l}),I(e),p(!1)},S=e=>{let t;let l=/{{(.*?)}}/g,r=[];for(;null!==(t=l.exec(e));)r.push(t[1]);return r},L=(0,n.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(p(!0),g(t[0].slice(1))):(p(!1),g(""))},[]),I=e=>{let t=S(e.content);if(f(t),t.length>0)w(!0);else{let t=null==d?void 0:d.replace(/\/\w*$/,e.content);c(t),a(t),L(e.content)}},_=e=>{let t=null==d?void 0:d.replace(/{{(.*?)}}/g,(t,l)=>{let r=v.indexOf(l);return e[r]});c(t),a(t),y&&y.current&&y.current.focus()},E=e=>{x&&("ArrowDown"===e.key?(e.preventDefault(),m(e=>e<r.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),m(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),m(e=>e<r.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),C()):"Escape"===e.key?(e.preventDefault(),p(!1)):m(0))};return(0,n.useEffect)(()=>{if(y&&y.current){var e;y.current.style.height="inherit",y.current.style.height="".concat(null===(e=y.current)||void 0===e?void 0:e.scrollHeight,"px")}},[d]),(0,n.useEffect)(()=>{c(l.prompt||"")},[l.prompt]),(0,n.useEffect)(()=>{let e=e=>{j.current&&!j.current.contains(e.target)&&p(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:i("System Prompt")}),(0,s.jsx)("textarea",{ref:y,className:"w-full rounded-lg border border-neutral-200 bg-transparent px-4 py-3 text-neutral-900 dark:border-neutral-600 dark:text-neutral-100",style:{borderColor:"".concat(d||1!==l.promptState?"":"red"),resize:"none",bottom:"".concat(null==y?void 0:null===(t=y.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"300px",overflow:"".concat(y.current&&y.current.scrollHeight>400?"auto":"hidden")},placeholder:i('Enter a prompt or type "/" to select a prompt...')||"",value:d||"",rows:1,onChange:N,onKeyDown:E}),!d&&1===l.promptState&&(0,s.jsx)("div",{style:{color:"red",marginTop:"2px"},children:"The prompt of this model cannot be empty!"}),x&&k.length>0&&(0,s.jsx)("div",{children:(0,s.jsx)(z,{activePromptIndex:u,prompts:k,onSelect:C,onMouseOver:m,promptListRef:j})}),b&&(0,s.jsx)(O,{prompt:r[u],variables:v,onSubmit:_,onClose:()=>w(!1)})]})};var F=l(8861),$=l(21942),B=l(74075),W=l(24888),Y=l(88198),X=l(93625),V=l(67828),q=l(80335),Q=l(93179),ee=l(84283);let et={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},el=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l="ABCDEFGHJKLMNPQRSTUVWXY3456789",r="";for(let t=0;t<e;t++)r+=l.charAt(Math.floor(Math.random()*l.length));return t?r.toLowerCase():r},er=(0,n.memo)(e=>{let{language:t,value:l}=e,{t:r}=(0,o.$G)("markdown"),[a,i]=(0,n.useState)(!1),d=()=>{navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(l).then(()=>{i(!0),setTimeout(()=>{i(!1)},2e3)})},c=()=>{let e=et[t]||".file",a="file-".concat(el(3,!0)).concat(e),s=window.prompt(r("Enter file name")||"",a);if(!s)return;let n=new Blob([l],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.download=s,i.href=o,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,s.jsxs)("div",{className:"codeblock relative font-sans text-[16px]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between py-1.5 px-4",children:[(0,s.jsx)("span",{className:"text-xs lowercase text-white",children:t}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("button",{className:"flex gap-1.5 items-center rounded bg-none p-1 text-xs text-white",onClick:d,children:[a?(0,s.jsx)(Y.Z,{size:18}):(0,s.jsx)(V.Z,{size:18}),a?r("Copied!"):r("Copy code")]}),(0,s.jsx)("button",{className:"flex items-center rounded bg-none p-1 text-xs text-white",onClick:c,children:(0,s.jsx)(q.Z,{size:18})})]})]}),(0,s.jsx)(Q.Z,{language:t,style:ee.vk,customStyle:{margin:0},children:l})]})});er.displayName="CodeBlock";var ea=l(16202);let es=(0,n.memo)(ea.D,(e,t)=>e.children===t.children);var en=l(45884),eo=l(29758),ei=l(30399);let ed=(0,n.memo)(e=>{var t;let{message:l,maxImg:r,messageIndex:a,onRegenerate:i,onEdit:d}=e,{t:c}=(0,o.$G)("chat"),{state:{selectedConversation:u,conversations:m,currentMessage:x,messageIsStreaming:p},dispatch:h}=(0,n.useContext)(I),[g,v]=(0,n.useState)(!1),[b,w]=(0,n.useState)(!1),[y,j]=(0,n.useState)(""),[k,N]=(0,n.useState)([]),[C,S]=(0,n.useState)(!1),L=(0,n.useRef)(null),_=()=>{v(!g)},E=e=>{j(e.target.value),L.current&&(L.current.style.height="inherit",L.current.style.height="".concat(L.current.scrollHeight,"px"))},P=()=>{let e=!1,t=!1,r=y,a=z(l.content);k.length>0?((0===a.imgList.length||k.length!==a.imgList.length)&&(t=!0),a.text!==y&&(e=!0),r=[{type:"text",text:y}],k.forEach((e,l)=>{t||e===a.imgList[l]||(t=!0),Array.isArray(r)&&r.push({type:"image_url",image_url:{url:e}})})):(a.imgList.length>0&&(t=!0),l.content!=y&&(e=!0)),(e||t)&&u&&d&&d({...l,content:r}),v(!1)},T=()=>{if(!u)return;let{messages:e}=u,t=e.findIndex(e=>e===l);if(t<0)return;t<e.length-1&&"assistant"===e[t+1].role?e.splice(t,2):e.splice(t,1);let r={...u,messages:e},{single:a,all:s}=f(r,m);h({field:"selectedConversation",value:a}),h({field:"conversations",value:s})},A=e=>{"Enter"!==e.key||b||e.shiftKey||(e.preventDefault(),P())},z=e=>{let t="",l=[];return Array.isArray(e)?e.forEach(e=>{"text"===e.type?t=e.text||"":"image_url"===e.type&&e.image_url&&l.push(e.image_url.url)}):t=e,{text:t,imgList:l}},O=()=>{navigator.clipboard&&navigator.clipboard.writeText(z(l.content).text).then(()=>{S(!0),setTimeout(()=>{S(!1)},2e3)})},Z=e=>{let t=z(e);N(t.imgList),j(t.text)};(0,n.useEffect)(()=>{Z(l.content)},[l.content]),(0,n.useEffect)(()=>{L.current&&(L.current.style.height="inherit",L.current.style.height="".concat(L.current.scrollHeight,"px"))},[g]);let R=e=>{k.length+e.length<=r?N(t=>[...t,...e]):N(t=>{let l=[...t,...e];return l.slice(-r)})},K=e=>{let t=e.target.files;if(t){let e=[],l=[];for(let r=0;r<t.length;r++){let a=t[r],s=new FileReader;l.push(new Promise(t=>{s.onloadend=()=>{e.push(s.result),t()}})),s.readAsDataURL(a)}Promise.all(l).then(()=>{R(e)})}},G=e=>{N(t=>{let l=[...t];return l.splice(e,1),l})};return(0,s.jsx)("div",{className:"group md:px-4 ".concat("assistant"===l.role?"border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100":"border-b border-black/10 bg-white text-gray-800 dark:border-gray-900/50 dark:bg-[#343541] dark:text-gray-100"),style:{overflowWrap:"anywhere"},children:(0,s.jsxs)("div",{className:"relative m-auto flex p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,s.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"assistant"===l.role?(0,s.jsx)(D.Z,{size:30}):(0,s.jsx)(F.Z,{size:30})}),(0,s.jsx)("div",{className:"prose mt-[-2px] w-full dark:prose-invert",children:"user"===l.role?(0,s.jsxs)("div",{className:"flex w-full",children:[g?(0,s.jsxs)("div",{className:"flex w-full flex-col",children:[(0,s.jsx)("textarea",{ref:L,className:"w-full resize-none whitespace-pre-wrap border-none dark:bg-[#343541]",value:y,onChange:E,onKeyDown:A,onCompositionStart:()=>w(!0),onCompositionEnd:()=>w(!1),style:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",padding:"0",margin:"0",overflow:"hidden"}}),(0,s.jsxs)("div",{className:"flex",children:[k.map((e,t)=>(0,s.jsx)("div",{style:{position:"relative",display:"inline-block",marginRight:"10px"},children:(0,s.jsxs)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",position:"relative"},children:[(0,s.jsx)("img",{src:e,alt:"Uploaded",className:"my-0",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,s.jsx)("div",{style:{position:"absolute",top:"5px",right:"5px",cursor:"pointer"},onClick:()=>G(t),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-circle",viewBox:"0 0 16 16",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zM7.354 8l-2.88 2.879a.5.5 0 0 1-.708-.708L6.646 8 3.766 5.121a.5.5 0 0 1 .708-.708L8 7.354l2.879-2.88a.5.5 0 0 1 .708.708L8.354 8l2.879 2.879a.5.5 0 0 1-.708.708L8 8.354 5.121 11.233a.5.5 0 0 1-.708-.708L7.354 8z"})})})]})},t)),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:K,style:{display:"none"},id:"upload-button"}),(0,s.jsx)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",cursor:"pointer",textAlign:"center",lineHeight:"100px"},className:"flex justify-center items-center"+(k.length>=r?" hidden":""),onClick:()=>{var e;null===(e=document.getElementById("upload-button"))||void 0===e||e.click()},children:(0,s.jsx)("div",{className:"text-4xl",children:"+"})})]}),(0,s.jsxs)("div",{className:"mt-10 flex justify-center space-x-4",children:[(0,s.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:P,disabled:y.trim().length<=0,children:c("Save & Submit")}),(0,s.jsx)("button",{className:"h-[40px] rounded-md border border-neutral-300 px-4 py-1 text-sm font-medium text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",onClick:()=>{Z(l.content),v(!1)},children:c("Cancel")})]})]}):(0,s.jsxs)("div",{className:"prose whitespace-pre-wrap dark:prose-invert flex-1",children:[z(l.content).text,(0,s.jsx)("div",{className:"flex items-center",children:z(l.content).imgList.map((e,t)=>(0,s.jsx)("div",{style:{marginRight:"10px",flex:1},children:(0,s.jsx)("img",{src:e,alt:"Uploaded"})},t))})]}),!g&&(0,s.jsxs)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:[(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:_,children:(0,s.jsx)($.Z,{size:20})}),(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:T,children:(0,s.jsx)(B.Z,{size:20})})]})]}):(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)(es,{className:"prose dark:prose-invert flex-1",remarkPlugins:[eo.Z,ei.Z],rehypePlugins:[en.Z],components:{code(e){let{node:t,inline:l,className:r,children:a,...n}=e;if(a.length){if("▍"==a[0])return(0,s.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"});a[0]=a[0].replace("`▍`","▍")}let o=/language-(\w+)/.exec(r||"");return l?(0,s.jsx)("code",{className:r,...n,children:a}):(0,s.jsx)(er,{language:o&&o[1]||"",value:String(a).replace(/\n$/,""),...n},Math.random())},table(e){let{children:t}=e;return(0,s.jsx)("table",{className:"border-collapse border border-black px-3 py-1 dark:border-white",children:t})},th(e){let{children:t}=e;return(0,s.jsx)("th",{className:"break-words border border-black bg-gray-500 px-3 py-1 text-white dark:border-white",children:t})},td(e){let{children:t}=e;return(0,s.jsx)("td",{className:"break-words border border-black px-3 py-1 dark:border-white",children:t})}},children:"".concat(l.content).concat(p&&a==(null!==(t=null==u?void 0:u.messages.length)&&void 0!==t?t:0)-1?"`▍`":"")}),(0,s.jsxs)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:[(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:i,children:(0,s.jsx)(W.Z,{size:20})}),C?(0,s.jsx)(Y.Z,{size:20,className:"text-green-500 dark:text-green-400"}):(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:O,children:(0,s.jsx)(X.Z,{size:20})})]})]})})]})})});ed.displayName="ChatMessage";let ec=(0,n.memo)(ed,(e,t)=>e.message.content===t.message.content),eu=async(e,t,l,r,a,s)=>{let n;n=t?[{role:"system",content:t},...s]:s;let o=await fetch("".concat(r,"/v1/chat/completions"),{headers:{accept:"application/json","Content-Type":"text/event-stream"},method:"POST",body:JSON.stringify({model:e.id,messages:n,stream:!0})});return o.body},em=async(e,t,l,r,a,s)=>{let n=await fetch("".concat(r,"/v1/chat/completions"),{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({model:e.id,messages:[{role:"system",content:t},...s],stream:!1})});return await n.json()},ex=(0,n.memo)(e=>{var t,l;let r,a;let i,{stopConversationRef:d}=e,{t:c}=(0,o.$G)("chat"),{state:{selectedConversation:u,conversations:m,models:x,isStream:p,lightMode:g,api:v,apiKey:y,pluginKeys:j,modelError:k,loading:N,prompts:C},handleUpdateConversation:_,dispatch:E}=(0,n.useContext)(I),[P,T]=(0,n.useState)(),[A,z]=(0,n.useState)(0),[O,D]=(0,n.useState)(!0),[G,J]=(0,n.useState)(!1),[F,$]=(0,n.useState)(!1),B=(0,n.useRef)(null),W=(0,n.useRef)(null),Y=(0,n.useRef)(null),X=[],V="",q=!0,Q=!1,ee=!0;async function et(e){return new Promise(t=>setTimeout(t,e))}async function el(){if(ee&&u&&X.length>0){ee=!1;for(let e=0;e<X.length;e++)if(V+=X.shift(),V=V.replace(/<\|.*?\|>/g,""),q){q=!1,E({field:"loading",value:!1});let e=[...i.messages,{role:"assistant",content:V||""}];E({field:"selectedConversation",value:i={...i,messages:e}})}else{let e=i.messages.map((e,t)=>t===i.messages.length-1?{...e,content:V}:e);b(i={...i,messages:e}),E({field:"selectedConversation",value:i});let t=m.map(e=>e.id===u.id?i:e);0===t.length&&t.push(i),E({field:"conversations",value:t}),w(t),Q?await et(50):await et(X.length>10?300:100)}ee=!0}}let er=(0,n.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2],u){let r;if(t){let l=[...u.messages];for(let e=0;e<t;e++)l.pop();i={...u,messages:[...l,e]}}else if(i={...u,messages:[...u.messages,e]},0===u.messages.length){var l;i={...i,name:"string"==typeof e.content?e.content:(null===(l=e.content.find(e=>"text"===e.type))||void 0===l?void 0:l.text)||""}}r=i.messages.map(e=>"string"!=typeof e.content?{...e,content:e.content.map(e=>"image_url"===e.type&&e.image_url&&e.image_url.url.startsWith("data:image/")?{...e,image_url:{url:e.image_url.url.split(",")[1]}}:e)}:e),E({field:"selectedConversation",value:i}),E({field:"loading",value:!0}),E({field:"messageIsStreaming",value:!0});let a={model:i.model,messages:r,key:y,prompt:i.prompt,temperature:i.temperature},s=new AbortController;try{let{model:e,messages:t,key:l,prompt:r,temperature:n}=a,o=n;null==o&&(o=h);let d=[];for(let e=t.length-1;e>=0;e--){let l=t[e];d=[l,...d]}if(p){let t=await eu(e,r,o,v,l,d);if(t){let e="",l=new TextDecoder,r=t.getReader();for(;!Q||X.length>0;){let{value:t,done:a}=await r.read();a&&(Q=!0);let s=l.decode(t);if(s){let t=s.split("\n\n");t.forEach(t=>{let l=!1;if((t=t.trim()).startsWith("data: ")&&(t=t.substring(6).trim()),"[DONE]"===t?Q=!0:t.startsWith("{")?t.endsWith("}")||(e=t,l=!0):e?(t=e+t,e=""):l=!0,!l&&!Q)try{if(t){let e=JSON.parse(t);e&&e.choices&&e.choices.forEach(e=>{e&&e.delta&&e.delta.content&&X.push(e.delta.content)})}}catch(e){console.log("error JSON",t)}})}ee&&await el()}E({field:"messageIsStreaming",value:!1}),s.abort()}else E({field:"loading",value:!1}),E({field:"messageIsStreaming",value:!1})}else{let t=await em(e,r,o,v,l,d);if(t){let e=t.choices[0].message,l=[...i.messages,{role:"assistant",content:e.content}];i={...i,messages:l},E({field:"selectedConversation",value:f}),b(i);let r=m.map(e=>e.id===u.id?i:e);0===r.length&&r.push(i),E({field:"conversations",value:r}),w(r),E({field:"loading",value:!1}),E({field:"messageIsStreaming",value:!1}),E({field:"selectedConversation",value:i})}}}catch(e){console.error(e)}}},[v,y,m,j,p,u,d]);(0,n.useCallback)(()=>{if(O){var e,t;null===(e=B.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),null===(t=Y.current)||void 0===t||t.focus()}},[O]);let ea=()=>{if(W.current){let{scrollTop:e,scrollHeight:t,clientHeight:l}=W.current;e+l<t-30?(D(!1),$(!0)):(D(!0),$(!1))}},es=()=>{var e;null===(e=W.current)||void 0===e||e.scrollTo({top:W.current.scrollHeight,behavior:"smooth"})},en=()=>{J(!G)},eo=()=>{confirm(c("Are you sure you want to clear all messages?"))&&u&&_(u,{key:"messages",value:[]})},ei=()=>{if(O){var e;null===(e=B.current)||void 0===e||e.scrollIntoView(!0)}},ed=function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];a?(clearTimeout(r),r=setTimeout(()=>{Date.now()-a>=250&&(ei(...t),a=Date.now())},250-(Date.now()-a))):(ei(...t),a=Date.now())};return(0,n.useEffect)(()=>{ed(),u&&(z(null==u?void 0:u.messages.reduce((e,t)=>(Array.isArray(t.content)&&(e+=t.content.reduce((e,t)=>("image_url"===t.type&&t.image_url&&e++,e),0)),e),0)),T(u.messages[u.messages.length-2]))},[u,ed]),(0,n.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;if(D(t.isIntersecting),t.isIntersecting){var l;null===(l=Y.current)||void 0===l||l.focus()}},{root:null,threshold:.5}),t=B.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[B]),(0,s.jsx)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541]",children:y||v?k?(0,s.jsx)(M,{error:k}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"max-h-full overflow-x-hidden",ref:W,onScroll:ea,children:(null==u?void 0:null===(t=u.messages)||void 0===t?void 0:t.length)===0?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"mx-auto flex flex-col space-y-5 md:space-y-10 px-3 pt-5 md:pt-12 sm:max-w-[600px]",children:[(0,s.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:(null==x?void 0:x.length)===0?(0,s.jsx)("div",{children:(0,s.jsx)(K,{size:"16px",className:"mx-auto"})}):(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,s.jsx)("img",{style:{height:"4rem"},src:"/llamaedge.svg"}),"LlamaEdge Chat"]})}),(null==x?void 0:x.length)>0&&(0,s.jsxs)("div",{className:"flex h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600",children:[(0,s.jsx)(U,{}),(null==u?void 0:u.promptState)!==2&&(0,s.jsx)(H,{conversation:u,prompts:C,onChangePrompt:e=>_(u,{key:"prompt",value:e})})]})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"sticky top-0 z-10 flex justify-center border border-b-neutral-300 bg-neutral-100 py-2 text-sm text-neutral-500 dark:border-none dark:bg-[#444654] dark:text-neutral-200",children:[c("Model"),": ",null==u?void 0:null===(l=u.model)||void 0===l?void 0:l.id," | ",c("Temp"),": ",null==u?void 0:u.temperature," |",(0,s.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:en,children:(0,s.jsx)(S.Z,{size:18})}),(0,s.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:eo,children:(0,s.jsx)(L.Z,{size:18})})]}),G&&(0,s.jsx)("div",{className:"flex flex-col space-y-10 md:mx-auto md:max-w-xl md:gap-6 md:py-3 md:pt-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:(0,s.jsx)("div",{className:"flex h-full flex-col space-y-4 border-b border-neutral-200 p-4 dark:border-neutral-600 md:rounded-lg md:border",children:(0,s.jsx)(U,{})})}),(null==u?void 0:u.messages)&&u.messages.map((e,t)=>(0,s.jsx)(ec,{message:e,messageIndex:t,maxImg:1-A,onRegenerate:()=>{P&&er(P,u.messages.length-t+1,null)},onEdit:e=>{T(e),er(e,(null==u?void 0:u.messages.length)-t)}},t)),N&&(0,s.jsx)(R,{}),(0,s.jsx)("div",{className:"h-[162px] bg-white dark:bg-[#343541]",ref:B})]})}),((null==u?void 0:u.promptState)!==1||(null==u?void 0:u.prompt)!=="")&&(0,s.jsx)(Z,{maxImg:1-A,stopConversationRef:d,textareaRef:Y,onSend:(e,t)=>{T(e),er(e,0,t)},onScrollDownClick:es,onRegenerate:()=>{P&&er(P,2,null)},showScrollDownButton:F})]}):(0,s.jsxs)("div",{className:"mx-auto flex h-full w-[300px] flex-col justify-center space-y-6 sm:w-[600px]",children:[(0,s.jsx)("div",{className:"text-center text-4xl font-bold text-black dark:text-white",children:"Welcome to LlamaEdge Chat"}),(0,s.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:[(0,s.jsx)("div",{className:"mb-2",children:"LlamaEdge Chat allows you to plug in your API key to use this UI with their API."}),(0,s.jsxs)("div",{className:"mb-2",children:["It is ",(0,s.jsx)("span",{className:"italic",children:"only"})," used to communicate with their API."]})]})]})})});ex.displayName="Chat";let ep=()=>{let e=localStorage.getItem("conversationHistory"),t=localStorage.getItem("folders"),l=localStorage.getItem("prompts");e&&(e=JSON.parse(e)),t&&(t=JSON.parse(t)),l&&(l=JSON.parse(l));let r={version:4,history:e||[],folders:t||[],prompts:l||[]},a=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.download="chatbot_ui_history_".concat(function(){let e=new Date,t=e.getMonth()+1,l=e.getDate();return"".concat(t,"-").concat(l)}(),".json"),n.href=s,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},eh=e=>{let{history:t,folders:l,prompts:r}=function(e){if(Array.isArray(e))return{version:4,history:v(e),folders:[],prompts:[]};if(!("version"in e)&&"folders"in e&&"history"in e)return{version:4,history:v(e.history||[]),folders:(e.folders||[]).map(e=>({id:e.id.toString(),name:e.name,type:"chat"})),prompts:[]};if(3===e.version)return{...e,version:4,prompts:[]};if(4===e.version)return e;throw Error("Unsupported data format")}(e),a=localStorage.getItem("conversationHistory"),s=a?JSON.parse(a):[],n=[...s,...t].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));localStorage.setItem("conversationHistory",JSON.stringify(n)),n.length>0?localStorage.setItem("selectedConversation",JSON.stringify(n[n.length-1])):localStorage.removeItem("selectedConversation");let o=localStorage.getItem("folders"),i=o?JSON.parse(o):[],d=[...i,...l].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));localStorage.setItem("folders",JSON.stringify(d));let c=localStorage.getItem("prompts"),u=c?JSON.parse(c):[],m=[...u,...r].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));return localStorage.setItem("prompts",JSON.stringify(m)),{version:4,history:n,folders:d,prompts:m}};var eg=l(87664),ev=l(62577),ef=l(97283),eb=l(30471);let ew=e=>{let{handleClick:t,children:l}=e;return(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:t,children:l})},ey=e=>{let{currentFolder:t,searchTerm:l,handleDrop:r,folderComponent:a}=e,{handleDeleteFolder:o,handleUpdateFolder:i}=(0,n.useContext)(I),[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),[h,g]=(0,n.useState)(!1),v=e=>{"Enter"===e.key&&(e.preventDefault(),f())},f=()=>{i(t.id,x),p(""),m(!1)},b=e=>{e.dataTransfer&&(g(!0),r(e,t),e.target.style.background="none")},w=e=>{e.preventDefault()},y=e=>{e.target.style.background="#343541"},j=e=>{e.target.style.background="none"};return(0,n.useEffect)(()=>{u?c(!1):d&&m(!1)},[u,d]),(0,n.useEffect)(()=>{l?g(!0):g(!1)},[l]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative flex items-center",children:[u?(0,s.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3",children:[h?(0,s.jsx)(eg.Z,{size:18}):(0,s.jsx)(ev.Z,{size:18}),(0,s.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:x,onChange:e=>p(e.target.value),onKeyDown:v,autoFocus:!0})]}):(0,s.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>g(!h),onDrop:e=>b(e),onDragOver:w,onDragEnter:y,onDragLeave:j,children:[h?(0,s.jsx)(eg.Z,{size:18}):(0,s.jsx)(ev.Z,{size:18}),(0,s.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:t.name})]}),(d||u)&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ew,{handleClick:e=>{e.stopPropagation(),d?o(t.id):u&&f(),c(!1),m(!1)},children:(0,s.jsx)(Y.Z,{size:18})}),(0,s.jsx)(ew,{handleClick:e=>{e.stopPropagation(),c(!1),m(!1)},children:(0,s.jsx)(ef.Z,{size:18})})]}),!d&&!u&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ew,{handleClick:e=>{e.stopPropagation(),m(!0),p(t.name)},children:(0,s.jsx)(eb.Z,{size:18})}),(0,s.jsx)(ew,{handleClick:e=>{e.stopPropagation(),c(!0)},children:(0,s.jsx)(B.Z,{size:18})})]})]}),h?a:null]})};var ej=l(47447);let ek=(0,n.createContext)(void 0),eN=e=>{let{conversation:t}=e,{state:{selectedConversation:l,messageIsStreaming:r},handleSelectConversation:a,handleUpdateConversation:o}=(0,n.useContext)(I),{handleDeleteConversation:i}=(0,n.useContext)(ek),[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),h=e=>{"Enter"===e.key&&(e.preventDefault(),l&&v(l))},g=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("conversation",JSON.stringify(t))},v=e=>{x.trim().length>0&&(o(e,{key:"name",value:x}),p(""),m(!1))},f=e=>{e.stopPropagation(),d?i(t):u&&v(t),c(!1),m(!1)},b=e=>{e.stopPropagation(),c(!1),m(!1)},w=e=>{e.stopPropagation(),m(!0),l&&p(l.name)},y=e=>{e.stopPropagation(),c(!0)};return(0,n.useEffect)(()=>{u?c(!1):d&&m(!1)},[u,d]),(0,s.jsxs)("div",{className:"relative flex items-center",children:[u&&(null==l?void 0:l.id)===t.id?(0,s.jsxs)("div",{className:"flex w-full items-center gap-3 rounded-lg bg-[#343541]/90 p-3",children:[(0,s.jsx)(ej.Z,{size:18}),(0,s.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:x,onChange:e=>p(e.target.value),onKeyDown:h,autoFocus:!0})]}):(0,s.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90 ".concat(r?"disabled:cursor-not-allowed":""," ").concat((null==l?void 0:l.id)===t.id?"bg-[#343541]/90":""),onClick:()=>a(t),disabled:r,draggable:"true",onDragStart:e=>g(e,t),children:[(0,s.jsx)(ej.Z,{size:18}),(0,s.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3 ".concat((null==l?void 0:l.id)===t.id?"pr-12":"pr-1"),children:t.name})]}),(d||u)&&(null==l?void 0:l.id)===t.id&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ew,{handleClick:f,children:(0,s.jsx)(Y.Z,{size:18})}),(0,s.jsx)(ew,{handleClick:b,children:(0,s.jsx)(ef.Z,{size:18})})]}),(null==l?void 0:l.id)===t.id&&!d&&!u&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ew,{handleClick:w,children:(0,s.jsx)(eb.Z,{size:18})}),(0,s.jsx)(ew,{handleClick:y,children:(0,s.jsx)(B.Z,{size:18})})]})]})},eC=e=>{let{searchTerm:t}=e,{state:{folders:l,conversations:r},handleUpdateConversation:a}=(0,n.useContext)(I),o=(e,t)=>{if(e.dataTransfer){let l=JSON.parse(e.dataTransfer.getData("conversation"));a(l,{key:"folderId",value:t.id})}},i=e=>r&&r.filter(e=>e.folderId).map((t,l)=>{if(t.folderId===e.id)return(0,s.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,s.jsx)(eN,{conversation:t})},l)});return(0,s.jsx)("div",{className:"flex w-full flex-col pt-2",children:l.filter(e=>"chat"===e.type).sort((e,t)=>e.name.localeCompare(t.name)).map((e,l)=>(0,s.jsx)(ey,{searchTerm:t,currentFolder:e,handleDrop:o,folderComponent:i(e)},l))})};var eS=l(17248),eL=l(3742);let eI=e=>{let{open:t,onClose:l}=e,{t:r}=(0,o.$G)("settings"),a=N(),{state:i,dispatch:d}=c({initialState:a}),{dispatch:u}=(0,n.useContext)(I),m=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&window.addEventListener("mouseup",t)},t=e=>{window.removeEventListener("mouseup",t),l()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[l]);let x=()=>{u({field:"lightMode",value:i.theme}),u({field:"isStream",value:i.isStream}),console.log(i.isStream),C(i)};return t?(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:(0,s.jsx)("div",{className:"fixed inset-0 z-10 overflow-hidden",children:(0,s.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,s.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,s.jsxs)("div",{ref:m,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,s.jsx)("div",{className:"text-lg pb-4 font-bold text-black dark:text-neutral-200",children:r("Settings")}),(0,s.jsx)("div",{className:"text-sm font-bold mb-2 text-black dark:text-neutral-200",children:r("Theme")}),(0,s.jsxs)("select",{className:"w-full cursor-pointer bg-transparent p-2 text-neutral-700 dark:text-neutral-200",value:i.theme,onChange:e=>d({field:"theme",value:e.target.value}),children:[(0,s.jsx)("option",{value:"dark",children:r("Dark mode")}),(0,s.jsx)("option",{value:"light",children:r("Light mode")})]}),(0,s.jsx)("div",{className:"text-sm font-bold mb-2 text-black dark:text-neutral-200",children:r("Output type")}),(0,s.jsxs)("select",{className:"w-full cursor-pointer bg-transparent p-2 text-neutral-700 dark:text-neutral-200",value:i.isStream.toString(),onChange:e=>{console.log(e.target.value),d({field:"isStream",value:"true"===e.target.value})},children:[(0,s.jsx)("option",{value:"false",children:r("Completed output")}),(0,s.jsx)("option",{value:"true",children:r("Streaming output")})]}),(0,s.jsx)("button",{type:"button",className:"w-full px-4 py-2 mt-6 border rounded-lg shadow border-neutral-500 text-neutral-900 hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:()=>{x(),l()},children:r("Save")})]})]})})}):(0,s.jsx)(s.Fragment,{})};var e_=l(47083);let eE=e=>{let{text:t,icon:l,onClick:r}=e;return(0,s.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:r,children:[(0,s.jsx)("div",{children:l}),(0,s.jsx)("span",{children:t})]})},eP=e=>{let{api:t,onApiChange:l}=e,{t:r}=(0,o.$G)("sidebar"),[a,i]=(0,n.useState)(!1),[d,c]=(0,n.useState)(t),u=(0,n.useRef)(null),m=e=>{"Enter"===e.key&&(e.preventDefault(),x(d))},x=e=>{l(e.trim()),i(!1)};return(0,n.useEffect)(()=>{if(a){var e;null===(e=u.current)||void 0===e||e.focus()}},[a]),a?(0,s.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-3 px-3 transition-colors hover:bg-gray-500/10",children:[(0,s.jsx)(e_.Z,{size:18}),(0,s.jsx)("input",{ref:u,className:"ml-2 h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-white outline-none focus:border-neutral-100",value:d,onChange:e=>c(e.target.value),onKeyDown:m,placeholder:r("API Url")||"API Url"}),(0,s.jsxs)("div",{className:"flex w-[40px]",children:[(0,s.jsx)(Y.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),x(d)}}),(0,s.jsx)(ef.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),i(!1),c(t)}})]})]}):(0,s.jsx)(eE,{text:r("Chat API Url"),icon:(0,s.jsx)(e_.Z,{size:18}),onClick:()=>i(!0)})},eT=e=>{let{onClearConversations:t}=e,[l,r]=(0,n.useState)(!1),{t:a}=(0,o.$G)("sidebar"),i=()=>{t(),r(!1)};return l?(0,s.jsxs)("div",{className:"flex w-full cursor-pointer items-center rounded-lg py-3 px-3 hover:bg-gray-500/10",children:[(0,s.jsx)(B.Z,{size:18}),(0,s.jsx)("div",{className:"ml-3 flex-1 text-left text-[12.5px] leading-3 text-white",children:a("Are you sure?")}),(0,s.jsxs)("div",{className:"flex w-[40px]",children:[(0,s.jsx)(Y.Z,{className:"ml-auto mr-1 min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),i()}}),(0,s.jsx)(ef.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),r(!1)}})]})]}):(0,s.jsx)(eE,{text:a("Clear conversations"),icon:(0,s.jsx)(B.Z,{size:18}),onClick:()=>r(!0)})},eA=()=>{let{t:e}=(0,o.$G)("sidebar"),[t,l]=(0,n.useState)(!1),{state:{api:r,apiKey:a,lightMode:i,serverSideApiKeyIsSet:d,serverSidePluginKeysSet:c,conversations:u},dispatch:m}=(0,n.useContext)(I),{handleClearConversations:x,handleImportConversations:p,handleExportData:h,handleApiChange:g,handleApiKeyChange:v}=(0,n.useContext)(ek);return(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-1 border-t border-white/20 pt-1 text-sm",children:[u.length>0?(0,s.jsx)(eT,{onClearConversations:x}):null,(0,s.jsx)(eE,{text:"Follow us on twitter",icon:(0,s.jsx)(eS.Z,{size:18}),onClick:()=>window.open("https://twitter.com/realwasmedge","_blank")}),(0,s.jsx)(eE,{text:"GitHub",icon:(0,s.jsx)(eL.Z,{size:18}),onClick:()=>window.open("https://github.com/second-state/LlamaEdge","_blank")}),(0,s.jsx)(eE,{text:"Huggingface",icon:(0,s.jsx)(D.Z,{size:18}),onClick:()=>window.open("https://huggingface.co/second-state","_blank")}),(0,s.jsx)(eE,{text:e("Settings"),icon:(0,s.jsx)(S.Z,{size:18}),onClick:()=>l(!0)}),(0,s.jsx)(eP,{api:r,onApiChange:g}),(0,s.jsx)(eI,{open:t,onClose:()=>{l(!1)}})]})},ez=e=>{let{conversations:t}=e;return(0,s.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.filter(e=>!e.folderId).slice().reverse().map((e,t)=>(0,s.jsx)(eN,{conversation:e},t))})};var eO=l(1177),eZ=l(16745),eD=l(92005),eR=l(67421),eK=l(98963),eG=l(89014);let eM=e=>{let{onClick:t,side:l}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"fixed top-5 ".concat("right"===l?"right-[270px]":"left-[270px]"," z-50 h-7 w-7 hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===l?"right-[270px]":"left-[270px]"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===l?(0,s.jsx)(eK.Z,{}):(0,s.jsx)(eG.Z,{})}),(0,s.jsx)("div",{onClick:t,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]})},eJ=e=>{let{onClick:t,side:l}=e;return(0,s.jsx)("button",{className:"fixed top-2.5 ".concat("right"===l?"right-2":"left-2"," z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===l?"right-2":"left-2"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===l?(0,s.jsx)(eG.Z,{}):(0,s.jsx)(eK.Z,{})})},eU=e=>{let{placeholder:t,searchTerm:l,onSearch:r}=e,{t:a}=(0,o.$G)("sidebar"),n=e=>{r(e.target.value)},i=()=>{r("")};return(0,s.jsxs)("div",{className:"relative flex items-center",children:[(0,s.jsx)("input",{className:"w-full flex-1 rounded-md border border-neutral-600 bg-[#202123] px-4 py-3 pr-10 text-[14px] leading-3 text-white",type:"text",placeholder:a(t)||"",value:l,onChange:n}),l&&(0,s.jsx)(ef.Z,{className:"absolute right-4 cursor-pointer text-neutral-300 hover:text-neutral-400",size:18,onClick:i})]})},eH=e=>{let{isOpen:t,addItemButtonTitle:l,canCreateChat:r,side:a,items:n,itemComponent:o,folderComponent:i,footerComponent:d,searchTerm:c,handleSearchTerm:u,toggleOpen:m,handleCreateItem:x,handleCreateFolder:p,handleDrop:h}=e,{t:g}=(0,eR.$G)("promptbar"),v=e=>{e.preventDefault()},f=e=>{e.target.style.background="#343541"},b=e=>{e.target.style.background="none"};return t?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"fixed top-0 ".concat(a,"-0 z-40 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 text-[14px] transition-all sm:relative sm:top-0"),children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("button",{disabled:!r,className:"text-sidebar flex w-[190px] flex-shrink-0 select-none items-center gap-3 rounded-md border border-white/20 p-3 text-white transition-colors duration-200 hover:bg-gray-500/10 "+(r?"cursor-pointer":"cursor-not-allowed"),onClick:()=>{x(),u("")},children:[(0,s.jsx)(eO.Z,{size:16}),l]}),(0,s.jsx)("button",{disabled:!r,className:"ml-2 flex flex-shrink-0 items-center gap-3 rounded-md border border-white/20 p-3 text-sm text-white transition-colors duration-200 hover:bg-gray-500/10 "+(r?"cursor-pointer":"cursor-not-allowed"),onClick:p,children:(0,s.jsx)(eZ.Z,{size:16})})]}),(0,s.jsx)(eU,{placeholder:g("Search...")||"",searchTerm:c,onSearch:u}),(0,s.jsxs)("div",{className:"flex-grow overflow-auto",children:[(null==n?void 0:n.length)>0&&(0,s.jsx)("div",{className:"flex border-b border-white/20 pb-2",children:i}),(null==n?void 0:n.length)>0?(0,s.jsx)("div",{className:"pt-2",onDrop:h,onDragOver:v,onDragEnter:f,onDragLeave:b,children:o}):(0,s.jsxs)("div",{className:"mt-8 select-none text-center text-white opacity-50",children:[(0,s.jsx)(eD.Z,{className:"mx-auto mb-3"}),(0,s.jsx)("span",{className:"text-[14px] leading-normal",children:g("No data.")})]})]}),d]}),(0,s.jsx)(eM,{onClick:m,side:a})]}):(0,s.jsx)(eJ,{onClick:m,side:a})},eF={searchTerm:"",filteredConversations:[]};var e$=l(57632);let eB=()=>{let{t:e}=(0,o.$G)("sidebar"),t=c({initialState:eF}),{state:{conversations:l,showChatbar:r,models:a,folders:i,pluginKeys:d},dispatch:u,handleCreateFolder:m,handleNewConversation:x,handleUpdateConversation:p}=(0,n.useContext)(I),{state:{searchTerm:g,filteredConversations:v},dispatch:f}=t,j=(0,n.useCallback)(e=>{u({field:"api",value:e}),localStorage.setItem("api",e)},[u]),k=(0,n.useCallback)(e=>{u({field:"apiKey",value:e}),localStorage.setItem("apiKey",e)},[u]),N=e=>{if(d.some(t=>t.pluginId===e.pluginId)){let t=d.map(t=>t.pluginId===e.pluginId?e:t);u({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))}else u({field:"pluginKeys",value:[...d,e]}),localStorage.setItem("pluginKeys",JSON.stringify([...d,e]))},C=e=>{let t=d.filter(t=>t.pluginId!==e.pluginId);if(0===t.length){u({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys");return}u({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))},S=()=>{ep()},L=e=>{let{history:t,folders:l,prompts:r}=eh(e);u({field:"conversations",value:t}),u({field:"selectedConversation",value:t[t.length-1]}),u({field:"folders",value:l}),u({field:"prompts",value:r}),window.location.reload()},_=()=>{if(a&&a.length>0){var t,l;u({field:"selectedConversation",value:{id:(0,e$.Z)(),name:e("New Conversation"),messages:[],model:a[0],prompt:(null===(t=J.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===t?void 0:t.content)||"",promptState:(null===(l=J.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===l?void 0:l.controlState)||0,temperature:h,folderId:null}})}u({field:"conversations",value:[]}),localStorage.removeItem("conversationHistory"),localStorage.removeItem("selectedConversation");let r=i.filter(e=>"chat"!==e.type);u({field:"folders",value:r}),y(r)},E=t=>{let r=l.filter(e=>e.id!==t.id);if(u({field:"conversations",value:r}),f({field:"searchTerm",value:""}),w(r),r.length>0)u({field:"selectedConversation",value:r[r.length-1]}),b(r[r.length-1]);else{if(a&&a.length>0){var s,n;u({field:"selectedConversation",value:{id:(0,e$.Z)(),name:e("New Conversation"),messages:[],model:a[0],prompt:(null===(s=J.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===s?void 0:s.content)||"",promptState:(null===(n=J.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===n?void 0:n.controlState)||0,temperature:h,folderId:null}})}localStorage.removeItem("selectedConversation")}},P=()=>{u({field:"showChatbar",value:!r}),localStorage.setItem("showChatbar",JSON.stringify(!r))},T=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("conversation"));p(t,{key:"folderId",value:0}),f({field:"searchTerm",value:""}),e.target.style.background="none"}};return(0,n.useEffect)(()=>{g?f({field:"filteredConversations",value:l.filter(e=>{let t=e.name.toLocaleLowerCase()+" "+e.messages.map(e=>e.content).join(" ");return t.toLowerCase().includes(g.toLowerCase())})}):f({field:"filteredConversations",value:l})},[g,l]),(0,s.jsx)(ek.Provider,{value:{...t,handleDeleteConversation:E,handleClearConversations:_,handleImportConversations:L,handleExportData:S,handlePluginKeyChange:N,handleClearPluginKey:C,handleApiChange:j,handleApiKeyChange:k},children:(0,s.jsx)(eH,{side:"left",isOpen:r,canCreateChat:a&&a.length>0,addItemButtonTitle:e("New chat"),itemComponent:(0,s.jsx)(ez,{conversations:v}),folderComponent:(0,s.jsx)(eC,{searchTerm:g}),items:v,searchTerm:g,handleSearchTerm:e=>f({field:"searchTerm",value:e}),toggleOpen:P,handleCreateItem:x,handleCreateFolder:()=>m(e("New folder"),"chat"),handleDrop:T,footerComponent:(0,s.jsx)(eA,{})})})},eW=e=>{let{selectedConversation:t,onNewConversation:l}=e;return(0,s.jsxs)("nav",{className:"flex w-full justify-between bg-[#202123] py-3 px-4",children:[(0,s.jsx)("div",{className:"mr-4"}),(0,s.jsx)("div",{className:"max-w-[240px] overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),(0,s.jsx)(eO.Z,{className:"cursor-pointer hover:text-neutral-400 mr-8",onClick:l})]})},eY={api:".",apiKey:"",loading:!1,pluginKeys:[],lightMode:"dark",isStream:!0,messageIsStreaming:!1,modelError:null,models:[],folders:[],conversations:[],selectedConversation:void 0,currentMessage:void 0,prompts:[],temperature:1,showPromptbar:!0,showChatbar:!0,currentFolder:void 0,messageError:!1,searchTerm:"",defaultModelId:void 0,serverSideApiKeyIsSet:!1,serverSidePluginKeysSet:!1},eX=e=>{let t,{serverSideApiKeyIsSet:l,serverSidePluginKeysSet:r,defaultModelId:a}=e,{t:i}=(0,o.$G)("chat"),{getModels:u}=m(),x=c({initialState:eY}),{state:{api:p,apiKey:k,lightMode:C,folders:S,conversations:L,selectedConversation:_,prompts:E,models:P},dispatch:T}=x,A=(0,n.useRef)(!1),z=async()=>{t=await u({url:p,key:k}),T&&T({field:"models",value:t})};(0,n.useEffect)(()=>{P&&(!L||L&&0===L.length)&&K&&K()},[P]),(0,n.useEffect)(()=>{p&&z()},[p,k]);let O=e=>{T({field:"selectedConversation",value:e}),b(e)},Z=(e,t)=>{let l={id:(0,e$.Z)(),name:e,type:t},r=[...S,l];T({field:"folders",value:r}),y(r)},D=e=>{let t=S.filter(t=>t.id!==e);T({field:"folders",value:t}),y(t);let l=L.map(t=>t.folderId===e?{...t,folderId:null}:t);T({field:"conversations",value:l}),w(l);let r=E.map(t=>t.folderId===e?{...t,folderId:null}:t);T({field:"prompts",value:r}),j(r)},R=(e,t)=>{let l=S.map(l=>l.id===e?{...l,name:t}:l);T({field:"folders",value:l}),y(l)},K=()=>{let e=L[L.length-1];if(P&&P.length>0){var t,l,r;let a={id:(0,e$.Z)(),name:i("New Conversation"),messages:[],model:(null==e?void 0:e.model)||P[0],prompt:(null===(t=J.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=P[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===t?void 0:t.content)||"",promptState:(null===(l=J.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=P[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===l?void 0:l.controlState)||0,temperature:null!==(r=null==e?void 0:e.temperature)&&void 0!==r?r:h,folderId:null},s=[...L,a];T({field:"selectedConversation",value:a}),T({field:"conversations",value:s}),b(a),w(s),T({field:"loading",value:!1})}},G=(e,t)=>{let l={...e,[t.key]:t.value},{single:r,all:a}=f(l,L);T({field:"selectedConversation",value:r}),T({field:"conversations",value:a})},M=(e,t)=>{let l=Object.assign(e);t.forEach(e=>{l[e.key]=e.value});let{single:r,all:a}=f(l,L);T({field:"selectedConversation",value:r}),T({field:"conversations",value:a})};return(0,n.useEffect)(()=>{window.innerWidth<640&&T({field:"showChatbar",value:!1})},[_]),(0,n.useEffect)(()=>{l&&T({field:"serverSideApiKeyIsSet",value:l}),r&&T({field:"serverSidePluginKeysSet",value:r})},[l,r]),(0,n.useEffect)(()=>{var e,t,a,s,n;let o=N();o.theme&&T({field:"lightMode",value:o.theme}),o.isStream&&T({field:"isStream",value:o.isStream});let d=localStorage.getItem("api"),c=localStorage.getItem("apiKey");l?(T({field:"apiKey",value:""}),localStorage.removeItem("apiKey")):c&&T({field:"apiKey",value:c}),d&&T({field:"api",value:d});let u=localStorage.getItem("pluginKeys");r?(T({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys")):u&&T({field:"pluginKeys",value:u}),window.innerWidth<640&&T({field:"showChatbar",value:!1});let m=localStorage.getItem("showChatbar");m&&T({field:"showChatbar",value:"true"===m});let x=localStorage.getItem("folders");x&&T({field:"folders",value:JSON.parse(x)});let p=localStorage.getItem("prompts");p&&T({field:"prompts",value:JSON.parse(p)});let f=localStorage.getItem("conversationHistory");if(f){let e=JSON.parse(f),t=v(e);T({field:"conversations",value:t})}let b=localStorage.getItem("selectedConversation");if(b){let l=JSON.parse(b),r=g(l);if(r.model&&P&&P.length>0){let l=P.filter(e=>e.id===r.model.id);l&&0!==l.length||(r.model=P[0],r.prompt=(null===(e=J.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=P[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===e?void 0:e.content)||"",r.promptState=(null===(t=J.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=P[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===t?void 0:t.controlState)||0)}T({field:"selectedConversation",value:r})}else{let e=L[L.length-1],t={id:(0,e$.Z)(),name:i("New Conversation"),messages:[],temperature:null!==(a=null==e?void 0:e.temperature)&&void 0!==a?a:h,folderId:null};P&&P.length>0&&(t.model=P[0],t.prompt=(null===(s=J.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=P[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===s?void 0:s.content)||"",t.promptState=(null===(n=J.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=P[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===n?void 0:n.controlState)||0),T({field:"selectedConversation",value:t})}},[T,P,l,r]),(0,s.jsxs)(I.Provider,{value:{...x,handleNewConversation:K,handleCreateFolder:Z,handleDeleteFolder:D,handleUpdateFolder:R,handleSelectConversation:O,handleUpdateConversation:G,handleUpdateConversationAll:M},children:[(0,s.jsxs)(d(),{children:[(0,s.jsx)("title",{children:"LlamaEdge Chat"}),(0,s.jsx)("meta",{name:"description",content:"ChatGPT but better."}),(0,s.jsx)("meta",{name:"viewport",content:"height=device-height ,width=device-width, initial-scale=1, user-scalable=no"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),_&&(0,s.jsxs)("main",{className:"flex h-screen w-screen flex-col text-sm text-white dark:text-white ".concat(C),children:[(0,s.jsx)("div",{className:"fixed top-0 w-full sm:hidden",children:(0,s.jsx)(eW,{selectedConversation:_,onNewConversation:K})}),(0,s.jsxs)("div",{className:"flex h-full w-full pt-[48px] sm:pt-0",children:[(0,s.jsx)(eB,{}),(0,s.jsx)("div",{className:"flex flex-1",children:(0,s.jsx)(ex,{stopConversationRef:A})})]})]})]})};var eV=eX,eq=!0}},function(e){e.O(0,[879,560,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);